
/*************************************************************************  
* 프로시저명: dbo.UP_DBA_IAC_TRANS_MASTER
* 작성정보	: 2014-09-25 BY CHOI BO RA  서버간의 이관 정책 가져오기
* 관련페이지:  
* 내용		: 

* 수정정보	: 
**************************************************************************/
CREATE  PROCEDURE dbo.UP_DBA_IAC_TRANS_MASTER
AS

/* COMMON DECLARE */
SET NOCOUNT ON

/* USER DECLARE  */

/*BODY*/

INSERT INTO TRANS_INFO_MASTER_ACCUM
( SERVER_ID, SERVER_NAME, DB_NAME, TABLE_NAME, TO_SERVER_NAME, TO_DB_NAME, TO_TABLE_NAME, USE_YN, 
  WORK_TYPE, PERIOD_TYPE,PERIOD,TRANS_COLUMN,  PARTITION_YN, SSIS_YN, SP_NAME,
  JOB_NAME, MGR_NAME, MGR_TEAM, COMMENT, LOCAL_JOB_YN, REG_DT, CHG_DT, REG_ID, CHG_ID, 
  LAST_TRANS_DATE, REF_SEQNO, REF_P_SEQNO)
SELECT S.SERVER_ID,
	C.FROM_SERVER, C.FROM_DB, C.FROM_TABLE, 
	C.TO_SERVER, C.TO_DB, C.TO_TABLE, 
	'Y' AS USE_YN, C.WORK_TYPE, C.UNIT AS PERIOD_TYPE, C.PERIOD , 
	C.TRANS_COLUMN, C.PARTITION_YN, 'Y' AS SSIS_YN,  C.SP_NAME,
	C.JOB_NAME, P.MGR_NAME AS MGR_NAME, P.MGR_TEAM,P.INFO AS COMMENT,  'N' AS LOCAL_JOB_YN,
	C.REG_DT, C.CHG_DT, 'DB_JOB' AS REG_ID, 'DB_JOB' AS CHG_ID , 
	C.last_trans_value AS LAST_TRANS_DATE,
	C.SEQ_NO AS REF_SEQNO, C.P_SEQ_NO AS REF_P_SEQNO
FROM IAC_TRANS_MASTER  AS P WITH(NOLOCK) 
	JOIN IAC_TRANS_MASTER AS C WITH(NOLOCK) ON  P.seq_no = C.p_seq_no
	JOIN SERVERINFO AS S WITH(NOLOCK) ON S.SERVER_NAME = C.FROM_SERVER AND USE_YN = 'Y'
	--AND P.SEQ_NO <> C.SEQ_NO
ORDER BY C.P_SEQ_NO, C.SEQ_NO, C.FROM_SERVER, C.FROM_DB, C.FROM_TABLE


